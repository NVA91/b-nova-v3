---
nova_hardware:
  spec:
    name: "GMKtec Ryzen 7 8845HS"
    type: "mini_pc"
    cpu:
      model: "AMD Ryzen 7 8845HS"
      cores: 8
      threads: 16
      base_clock: "3.8 GHz"
      boost_clock: "5.1 GHz"
      tdp: 45
      architecture: "Zen 4"
    gpu:
      # Primary integrated GPU details
      primary:
        model: "AMD Radeon 780M"
        type: "integrated"
        compute_units: 12
        vram_shared: true
        max_frequency: "2700 MHz"
        rocm_support: true
        vulkan_support: true
        use_cases: ["transcoding", "media_playback", "light_compute"]

      # External GPU (eGPU) configuration
      egpu:
        enabled: true
        model: "NVIDIA GeForce RTX 5060 Ti"
        vram: "16 GB"
        vram_type: "GDDR7"
        architecture: "Blackwell"
        pcie_interface: "PCIe 4.0 x4 (OCuLink)"
        dock: "Minisforum DEG1"
        driver: "nvidia"
        cuda_support: true
        docker_runtime: "nvidia"
        device_mapping:
          - "/dev/nvidia0:/dev/nvidia0"
          - "/dev/nvidiactl:/dev/nvidiactl"
          - "/dev/nvidia-uvm:/dev/nvidia-uvm"
        environment:
          - "NVIDIA_VISIBLE_DEVICES=all"
          - "NVIDIA_DRIVER_CAPABILITIES=compute,utility,video"
        use_cases: ["ai_inference", "training", "cuda_compute", "gaming_vm"]
        passthrough:
          enabled: true
          pci_id: "10de:xxxx"  # To be determined via lspci
          iommu_group: "TBD"

    memory:
      total_gb: 32
      type: "DDR5"
      speed: "5600 MHz"
      channels: 2
    storage:
      vm_disk:
        device: "/dev/nvme0n1"
        size: "2 TB"
        type: "NVMe SSD"
        model: "WD Black SN850X"
        interface: "PCIe 4.0 x4"
        purpose: "VM Storage"
        filesystem: "zfs"
        zfs_pool: "vmpool"
        zfs_arc_max: "8 GB"
        mount_point: "/vmpool"
        use_cases: ["vm_disks", "vm_images", "vm_snapshots"]

      storage_disk:
        device: "/dev/nvme1n1"
        size: "2 TB"
        type: "NVMe SSD"
        interface: "PCIe 4.0 x4"
        purpose: "General Storage"
        filesystem: "zfs"
        zfs_pool: "tank"
        zfs_arc_max: "4 GB"
        mount_point: "/tank"
        use_cases: ["backups", "data", "media", "archives"]

      system_disk:
        device: "/dev/nvme2n1"
        size: "1 TB"
        type: "NVMe SSD"
        interface: "PCIe 4.0 x4"
        purpose: "System/Boot"
        partitions:
          - name: "boot"
            size: "1 GB"
            filesystem: "ext4"
            mount_point: "/boot"
          - name: "root"
            size: "100 GB"
            filesystem: "ext4"
            mount_point: "/"
          - name: "pve-data"
            size: "remaining"
            filesystem: "lvm"
            use_cases: ["proxmox_data", "lxc_containers", "system_backups"]

  docker:
    global_limits:
      cpu_count: 14
      memory: "28g"
      swap: "4g"
    agent_defaults:
      cpu_shares: 1024
      memory: "2g"
      memory_reservation: "1g"
    agent_profiles:
      core:     { cpu_count: 4, memory: "4g", priority: "high" }
      devops:   { cpu_count: 2, memory: "3g", priority: "high" }
      security: { cpu_count: 2, memory: "2g", priority: "high" }
      research: { cpu_count: 2, memory: "3g", priority: "medium" }
      dev:      { cpu_count: 2, memory: "2g", priority: "medium" }
      media:    { cpu_count: 2, memory: "4g", gpu_access: true, priority: "medium" }
      business: { cpu_count: 1, memory: "2g", priority: "low" }
      health:   { cpu_count: 1, memory: "1g", priority: "low" }
      ai:       { cpu_count: 3, memory: "6g", gpu_access: true, priority: "high" }

  gpu:
    # Backwards-compatible top-level flags
    enabled: true
    driver: "rocm"
    docker_runtime: ["nvidia", "rocm"]
    device_mapping:
      - "/dev/dri:/dev/dri"
      - "/dev/kfd:/dev/kfd"
    environment:
      - "HSA_OVERRIDE_GFX_VERSION=11.0.0"
      - "ROCR_VISIBLE_DEVICES=0"
    agents_with_gpu: ["media", "ai"]

  # NPU / AI accelerator (new)
  npu:
    enabled: true
    model: "AMD XDNA (Ryzen AI Engine)"
    tops: 16
    pci_id: "1022:1502"
    driver: "amd-xdna"
    kernel_min_version: "6.8"
    use_cases: ["object_detection", "continuous_inference", "frigate"]

  performance:
    governor: "performance"
    swappiness: 10
    docker_storage_driver: "overlay2"
    network:
      tcp_fastopen: true
      tcp_bbr: true
    io_scheduler: "mq-deadline"

  power:
    mode: "balanced"
    profiles:
      powersave:
        cpu_governor: "powersave"
        max_cpu_freq: "3.8 GHz"
        gpu_power_limit: 15
      balanced:
        cpu_governor: "schedutil"
        max_cpu_freq: "4.5 GHz"
        gpu_power_limit: 25
      performance:
        cpu_governor: "performance"
        max_cpu_freq: "5.1 GHz"
        gpu_power_limit: 35

  monitoring:
    cpu_temp_warning: 80
    cpu_temp_critical: 95
    memory_warning: 85
    memory_critical: 95
    disk_warning: 80
    disk_critical: 90